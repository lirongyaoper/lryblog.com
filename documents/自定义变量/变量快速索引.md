# lryblog.com 项目变量快速索引

本文档提供项目中所有自定义变量的快速查找索引。

**生成时间**：2025-10-06

---

## 一、常量定义速查表

### 系统核心常量

| 常量名 | 定义位置 | 值 | 说明 |
|--------|----------|-----|------|
| `RYPHP_DEBUG` | index.php:10 | true | 调试模式开关 |
| `RYPHP_ROOT` | index.php:12 | dirname(__FILE__).DS | 项目根目录 |
| `URL_MODEL` | index.php:16 | '3' | URL路由模式 |
| `IN_RYPHP` | ryphp/ryphp.php:17 | true | 框架运行标识 |
| `RYPHP_RYPHP` | ryphp/ryphp.php:19 | RYPHP_ROOT.'ryphp'.DS | 框架核心目录 |
| `RYPHP_COMMON` | ryphp/ryphp.php:20 | RYPHP_ROOT.'common'.DS | 公共资源目录 |
| `RYPHP_APP` | ryphp/ryphp.php:31 | RYPHP_ROOT.'application'.DS | 应用程序目录 |
| `RYPHP_VERSION` | ryphp/ryphp.php:22 | '1.0.0' | 框架版本号 |
| `RYPHP_RELEASE` | ryphp/ryphp.php:23 | '20250707' | 框架发布日期 |

### 时间相关常量

| 常量名 | 定义位置 | 值 | 说明 |
|--------|----------|-----|------|
| `SYS_START_TIME` | ryphp/ryphp.php:25 | microtime(true) | 系统启动时间 |
| `SYS_TIME` | ryphp/ryphp.php:28 | time() | 当前时间戳 |

### 网络相关常量

| 常量名 | 定义位置 | 值 | 说明 |
|--------|----------|-----|------|
| `SERVER_REQUEST_SCHEME` | ryphp/ryphp.php:37 | http(s):// | 请求协议 |
| `HTTP_HOST` | ryphp/ryphp.php:40 | $_SERVER['HTTP_HOST'] | 主机名 |
| `HTTP_REFERER` | ryphp/ryphp.php:42 | $_SERVER['HTTP_REFERER'] | 来源地址 |
| `IS_CGI` | ryphp/ryphp.php:47 | 0/1 | CGI模式检测 |

### 路径相关常量

| 常量名 | 定义位置 | 值 | 说明 |
|--------|----------|-----|------|
| `PHP_FILE` | ryphp/ryphp.php:56/58 | 动态 | 当前PHP文件路径 |
| `SITE_PATH` | ryphp/ryphp.php:62 | 计算值 | 站点相对路径 |
| `SITE_URL` | ryphp/ryphp.php:63 | 完整URL | 站点完整URL |
| `STATIC_URL` | ryphp/ryphp.php:64 | SITE_URL.../static/ | 静态资源URL |
| `EXT` | ryphp/ryphp.php:44 | '.class.php' | 类文件扩展名 |

### 路由相关常量

| 常量名 | 定义位置 | 值 | 说明 |
|--------|----------|-----|------|
| `ROUTE_M` | application.class.php:15 | 动态 | 当前模块名 |
| `ROUTE_C` | application.class.php:16 | 动态 | 当前控制器名 |
| `ROUTE_A` | application.class.php:17 | 动态 | 当前方法名 |

### 版本信息常量

| 常量名 | 定义位置 | 值 | 说明 |
|--------|----------|-----|------|
| `RYCMS_VERSION` | common/data/version.php:3 | 'V1.0' | CMS版本号 |
| `RYCMS_UPDATE` | common/data/version.php:4 | '20250808' | 更新日期 |
| `RYCMS_SOFTNAME` | ryphp/ryphp.php:81 | 'RYCMS内容管理系统' | 软件名称 |

### 安全标识常量

| 常量名 | 定义位置 | 值 | 说明 |
|--------|----------|-----|------|
| `IN_RYPHP_ADMIN` | common.class.php:3 | true | 后台管理标识 |
| `IN_ADMIN` | lry_action.php:125 | true | 管理员登录标识 |
| `RYPHP_DEBUG_HIDDEN` | global.func.php:1474 | true | 调试信息隐藏 |

### 功能类常量

| 常量名 | 定义位置 | 值 | 说明 |
|--------|----------|-----|------|
| `EFFECTED_INIT` | tree.class.php:315 | 1 | 树结构初始化 |
| `DATETIME` | form.class.php:160 | 1 | 日期时间字段 |
| `TOTAL_PAGE` | page.class.php:176 | 动态 | 总页数 |
| `MODULE_THEME` | global.func.php:1484 | 动态 | 模块主题 |
| `MAGIC_QUOTES_GPC` | ryphp.php:67/70/73 | bool | 魔术引号状态 |

---

## 二、配置变量速查表

### 系统配置 (config.php)

#### 基础配置

```php
'auth_key'         => 'xxx'           // 系统密钥
'error_page'       => '404.html'      // 错误页面
'error_log_save'   => 1               // 保存错误日志
'site_theme'       => 'rongyao'       // 默认主题
'url_html_suffix'  => '.html'         // URL后缀
'set_pathinfo'     => false           // PATHINFO支持
```

#### 数据库配置

```php
'db_type'     => 'pdo'           // 数据库类型: pdo|mysqli|mysql
'db_host'     => '127.0.0.1'     // 服务器地址
'db_name'     => 'rycms'         // 数据库名
'db_user'     => 'root'          // 用户名
'db_pwd'      => '3.3.'          // 密码
'db_port'     => 3306            // 端口
'db_charset'  => 'utf8'          // 字符集
'db_prefix'   => 'rycms_'        // 表前缀
```

#### Cookie配置

```php
'cookie_domain'   => ''              // 作用域
'cookie_path'     => '/'             // 作用路径
'cookie_ttl'      => 0               // 生命周期
'cookie_pre'      => 'lryphp_'       // 前缀
'cookie_secure'   => false           // HTTPS传输
'cookie_httponly' => false           // HTTP Only
```

#### 缓存配置

```php
'cache_type'      => 'file'          // 类型: file|redis|memcache
'file_config'     => array(...)      // 文件缓存配置
'redis_config'    => array(...)      // Redis配置
'memcache_config' => array(...)      // Memcache配置
```

#### 队列配置

```php
'queue_connection' => 'database'     // 驱动: database|redis
'queue_name'       => 'default'      // 队列名称
```

#### 上传配置

```php
'upload_type'        => 'host'       // 类型: host|qiniu|aliyun|tencent
'upload_file'        => 'uploads'    // 上传目录
'watermark_enable'   => 1            // 水印开关
'watermark_name'     => 'mark.png'   // 水印图片
'watermark_position' => '7'          // 水印位置
```

#### 其他配置

```php
'language'          => 'zh_cn'       // 语言: zh_cn|en_us
'sql_execute'       => false         // 在线SQL
'edit_template'     => false         // 在线编辑模板
'admin_login_code'  => 0             // 登录验证码
```

### 访问方式

```php
C('config_key')           // 快速访问
config('config.key')      // 配置文件
get_config('key')         // 数据库配置
env('ENV_KEY')            // 环境变量
```

---

## 三、核心函数速查表

### 配置相关

| 函数 | 说明 | 示例 |
|------|------|------|
| `C($key)` | 获取配置 | `C('db_host')` |
| `config($key)` | 获取配置文件 | `config('config.db_host')` |
| `get_config($key)` | 获取数据库配置 | `get_config('site_name')` |
| `env($key)` | 获取环境变量 | `env('APP_DEBUG')` |

### 数据库相关

| 函数 | 说明 | 示例 |
|------|------|------|
| `D($table)` | 数据库对象 | `D('admin')->select()` |
| `M($model)` | 模型对象 | `M('admin', 'lry_admin_center')` |

### 缓存相关

| 函数 | 说明 | 示例 |
|------|------|------|
| `getcache($name)` | 获取缓存 | `getcache('configs')` |
| `setcache($name, $data)` | 设置缓存 | `setcache('configs', $data)` |
| `delcache($name)` | 删除缓存 | `delcache('configs')` |

### Session相关

| 函数 | 说明 | 示例 |
|------|------|------|
| `new_session_start()` | 启动Session | `new_session_start()` |
| `create_token()` | 创建Token | `create_token()` |
| `check_token($token)` | 验证Token | `check_token($_POST['token'])` |

### Cookie相关

| 函数 | 说明 | 示例 |
|------|------|------|
| `set_cookie($name, $val)` | 设置Cookie | `set_cookie('user', $data)` |
| `get_cookie($name)` | 获取Cookie | `get_cookie('user')` |
| `del_cookie($name)` | 删除Cookie | `del_cookie('user')` |

### URL相关

| 函数 | 说明 | 示例 |
|------|------|------|
| `U($url, $vars)` | 生成URL | `U('index/index/init')` |
| `get_url()` | 当前URL | `get_url()` |
| `redirect($url)` | URL重定向 | `redirect('/admin')` |

### 请求判断

| 函数 | 说明 | 返回值 |
|------|------|--------|
| `is_ssl()` | HTTPS判断 | bool |
| `is_post()` | POST判断 | bool |
| `is_get()` | GET判断 | bool |
| `is_ajax()` | AJAX判断 | bool |

### 数据处理

| 函数 | 说明 | 示例 |
|------|------|------|
| `safe_replace($str)` | 安全过滤 | `safe_replace($_GET['id'])` |
| `remove_xss($str)` | XSS过滤 | `remove_xss($content)` |
| `string_auth($str, $op)` | 加密解密 | `string_auth($data, 'ENCODE')` |
| `array2string($arr)` | 数组转字符串 | `array2string($data)` |
| `string2array($str)` | 字符串转数组 | `string2array($json)` |

### 验证函数

| 函数 | 说明 | 返回值 |
|------|------|--------|
| `is_email($email)` | 邮箱验证 | bool |
| `is_mobile($mobile)` | 手机号验证 | bool |
| `is_username($user)` | 用户名验证 | bool |
| `is_password($pwd)` | 密码验证 | bool |
| `is_img($ext)` | 图片验证 | bool |

### 工具函数

| 函数 | 说明 | 示例 |
|------|------|------|
| `getip()` | 获取IP | `getip()` |
| `random($len)` | 随机字符串 | `random(6)` |
| `L($key)` | 语言包 | `L('login_success')` |
| `showmsg($msg, $url)` | 信息提示 | `showmsg('成功', '/')` |
| `template($tpl)` | 模板加载 | `template('index', 'home')` |
| `input($key)` | 获取输入 | `input('post.id')` |

### 内容管理

| 函数 | 说明 | 示例 |
|------|------|------|
| `get_category($id)` | 获取栏目 | `get_category(1)` |
| `get_catname($id)` | 栏目名称 | `get_catname(1)` |
| `get_childcat($id)` | 子栏目 | `get_childcat(1)` |
| `get_location($id)` | 面包屑 | `get_location(1)` |
| `get_content_url($catid, $id)` | 内容URL | `get_content_url(1, 100)` |

### 站点管理

| 函数 | 说明 | 示例 |
|------|------|------|
| `get_siteid()` | 站点ID | `get_siteid()` |
| `get_site($id)` | 站点信息 | `get_site(1)` |
| `get_site_url()` | 站点URL | `get_site_url()` |
| `get_site_seo()` | SEO信息 | `get_site_seo()` |

### 会员管理

| 函数 | 说明 | 示例 |
|------|------|------|
| `get_memberinfo($id)` | 会员信息 | `get_memberinfo(1)` |
| `get_memberavatar($id)` | 会员头像 | `get_memberavatar(1)` |
| `get_groupinfo($id)` | 组别信息 | `get_groupinfo(1)` |
| `password($pwd)` | 密码加密 | `password('123456')` |

### 图片处理

| 函数 | 说明 | 示例 |
|------|------|------|
| `thumb($img, $w, $h)` | 生成缩略图 | `thumb($img, 300, 200)` |
| `watermark($img)` | 添加水印 | `watermark($img)` |
| `get_thumb($img)` | 获取缩略图 | `get_thumb($img)` |

---

## 四、Session/Cookie 变量

### 管理员 Session

```php
$_SESSION['adminid']        // 管理员ID
$_SESSION['adminname']      // 管理员名称
$_SESSION['roleid']         // 角色ID
$_SESSION['rolename']       // 角色名称
$_SESSION['lry_sey_token']  // CSRF Token
$_SESSION['lry_lock_screen'] // 锁屏状态
```

### 会员 Session

```php
$_SESSION['_userid']        // 会员ID
$_SESSION['_username']      // 会员名称
$_SESSION['_groupid']       // 会员组ID
$_SESSION['_userpic']       // 会员头像
```

### Cookie 变量

```php
{$pre}adminid          // 管理员ID
{$pre}adminname        // 管理员名称
{$pre}_userid          // 会员ID
{$pre}_auth            // 认证字符串
{$pre}attachmentid     // 附件ID
```

注：`{$pre}` 为配置的Cookie前缀，默认 `lryphp_`

---

## 五、文件路径索引

### 常量定义文件

```
/index.php                                          核心入口
/ryphp/ryphp.php                                   框架核心
/common/data/version.php                           版本信息
/ryphp/core/class/application.class.php            应用类
/application/lry_admin_center/controller/common.class.php  后台基类
```

### 配置文件

```
/common/config/config.php                          主配置文件
/.env                                              环境变量（可选）
```

### 函数库文件

```
/ryphp/core/function/global.func.php               核心函数库
/common/function/system.func.php                   系统函数库
/common/function/extention.func.php                扩展函数库
```

### 类库文件

```
/ryphp/core/class/db_factory.class.php             数据库工厂
/ryphp/core/class/cache_factory.class.php          缓存工厂
/ryphp/core/class/param.class.php                  参数解析
/ryphp/core/class/upload.class.php                 上传处理
/ryphp/core/class/image.class.php                  图片处理
/ryphp/core/class/page.class.php                   分页处理
```

---

## 六、按目录组织的变量分布

### `/index.php` (入口文件)

- `RYPHP_DEBUG` - 调试模式
- `RYPHP_ROOT` - 根目录
- `URL_MODEL` - URL模式

### `/ryphp/` (框架核心)

#### `ryphp.php`
- 框架基础常量（15+个）
- 框架初始化

#### `core/function/global.func.php`
- 核心函数（100+个）
- 工具函数

#### `core/class/`
- 各类库常量
- 类属性配置

### `/common/` (公共资源)

#### `config/config.php`
- 系统配置（60+项）

#### `data/version.php`
- 版本信息常量

#### `function/`
- 业务函数库
- 扩展函数库

### `/application/` (应用层)

#### `index/` (前台模块)
- 前台业务逻辑

#### `lry_admin_center/` (后台模块)
- `common.class.php` - 后台基类
  - `IN_RYPHP_ADMIN` 常量
  - 权限验证逻辑

#### `install/` (安装模块)
- `index.php` - 安装程序
  - 安装相关常量

---

## 七、使用频率统计

### TOP 20 高频使用

1. `D()` - 500+次
2. `RYPHP_ROOT` - 300+次
3. `U()` - 300+次
4. `L()` - 200+次
5. `STATIC_URL` - 200+次
6. `get_category()` - 200+次
7. `C()` - 150+次
8. `showmsg()` - 150+次
9. `SYS_TIME` - 100+次
10. `get_content_url()` - 100+次
11. `is_post()` - 100+次
12. `new_html_special_chars()` - 100+次
13. `getip()` - 100+次
14. `get_siteid()` - 100+次
15. `template()` - 100+次
16. `safe_replace()` - 100+次
17. `ROUTE_M/C/A` - 各100+次
18. `SITE_URL` - 80+次
19. `get_cookie()` - 50+次
20. `is_ajax()` - 80+次

---

## 八、快速搜索技巧

### 1. 查找常量定义

```bash
# 搜索所有define
grep -r "define(" --include="*.php"

# 搜索特定常量
grep -r "RYPHP_ROOT" --include="*.php"
```

### 2. 查找函数定义

```bash
# 搜索函数定义
grep -r "^function " --include="*.php"

# 搜索特定函数
grep -r "function get_category" --include="*.php"
```

### 3. 查找配置使用

```bash
# 查找C函数调用
grep -r "C\(" --include="*.php"

# 查找配置键
grep -r "'db_host'" --include="*.php"
```

### 4. 查找Session使用

```bash
# 查找Session变量
grep -r "\$_SESSION\[" --include="*.php"
```

---

## 九、常见问题速查

### Q1: 如何获取系统配置？

```php
// 文件配置
C('db_host')              // 主配置文件

// 数据库配置
get_config('site_name')   // 数据库配置表

// 环境变量
env('APP_DEBUG')          // .env文件
```

### Q2: 如何生成URL？

```php
U('index/index/init')                    // 基本用法
U('index/index/init', 'id=1')           // 带参数
U('index/index/init', array('id'=>1))   // 数组参数
U('index/index/init', '', true)         // 完整域名
```

### Q3: 如何进行数据库操作？

```php
D('admin')->select()                     // 查询
D('admin')->where($where)->find()       // 单条
D('admin')->insert($data)               // 插入
D('admin')->update($data, $where)       // 更新
D('admin')->delete($where)              // 删除
```

### Q4: 如何使用缓存？

```php
getcache('key')                         // 获取
setcache('key', $data, 3600)           // 设置（1小时）
delcache('key')                         // 删除
delcache('', true)                      // 清空所有
```

### Q5: 如何进行权限验证？

```php
// 检查登录
if(!isset($_SESSION['adminid'])) {
    // 未登录
}

// 检查权限
if($_SESSION['roleid'] != 1) {
    // 非超级管理员
}
```

---

## 十、相关文档

- [自定义变量定义及使用分析](./自定义变量定义及使用分析.md) - 详细文档
- [项目常量文档](./Constant.md) - 常量说明
- [RYPHP框架文档](./ryphp.md) - 框架文档

---

**更新日期**：2025-10-06  
**文档版本**：1.0

