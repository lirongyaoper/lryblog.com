# lryblog.com 项目自定义变量定义及使用分析

本文档详细列出了 lryblog.com 项目中所有自定义变量的定义位置和使用位置。

**生成时间**：2025-10-06  
**项目版本**：RYCMS V1.0  
**框架版本**：RYPHP 1.0.0

---

## 目录

1. [常量定义 (define)](#1-常量定义-define)
2. [配置数组变量](#2-配置数组变量)
3. [全局函数变量](#3-全局函数变量)
4. [Session 变量](#4-session-变量)
5. [Cookie 变量](#5-cookie-变量)
6. [全局变量使用统计](#6-全局变量使用统计)

---

## 1. 常量定义 (define)

### 1.1 核心入口文件

#### `/index.php`
定义的常量：
- `RYPHP_DEBUG` = `true` - 调试模式开关
- `RYPHP_ROOT` = `dirname(__FILE__).DIRECTORY_SEPARATOR` - 项目根目录
- `URL_MODEL` = `'3'` - URL路由模式

使用位置：
- 全项目范围，作为基础配置常量
- `RYPHP_DEBUG` 在错误处理、模板编译、日志记录中使用
- `RYPHP_ROOT` 在所有文件路径拼接中使用
- `URL_MODEL` 在路由解析、URL生成中使用

---

### 1.2 框架核心文件

#### `/ryphp/ryphp.php`
定义的常量：

| 常量名 | 值 | 说明 | 主要使用位置 |
|--------|-----|------|-------------|
| `IN_RYPHP` | `true` | 框架运行标识 | 所有框架文件开头检查 |
| `RYPHP_RYPHP` | `RYPHP_ROOT . 'ryphp' . DIRECTORY_SEPARATOR` | 框架核心目录 | 加载系统类、函数时使用 |
| `RYPHP_COMMON` | `RYPHP_ROOT . 'common' . DIRECTORY_SEPARATOR` | 公共资源目录 | 加载公共文件、配置时使用 |
| `RYPHP_VERSION` | `'1.0.0'` | 框架版本号 | 版本信息显示 |
| `RYPHP_RELEASE` | `'20250707'` | 框架发布日期 | 版本信息显示 |
| `SYS_START_TIME` | `microtime(true)` | 系统启动时间 | 性能分析、调试信息 |
| `SYS_TIME` | `time()` | 当前时间戳 | 时间计算、日志记录 |
| `RYPHP_APP` | `RYPHP_ROOT.'application'.DIRECTORY_SEPARATOR` | 应用程序目录 | 加载控制器、模型、视图 |
| `SERVER_REQUEST_SCHEME` | `is_ssl() ? 'https://' : 'http://'` | 请求协议 | URL生成、跳转 |
| `HTTP_HOST` | `$_SERVER['HTTP_HOST']` | 主机名 | URL生成、域名检查 |
| `HTTP_REFERER` | `$_SERVER['HTTP_REFERER']` | 来源地址 | 安全检查、跳转逻辑 |
| `EXT` | `'.class.php'` | 类文件扩展名 | 自动加载类文件 |
| `IS_CGI` | `0 或 1` | CGI模式检测 | 路径处理 |
| `PHP_FILE` | 动态计算 | 当前PHP文件路径 | URL路径计算 |
| `SITE_PATH` | `str_replace('index.php', '' , PHP_FILE)` | 站点相对路径 | URL生成 |
| `SITE_URL` | `SERVER_REQUEST_SCHEME.HTTP_HOST.SITE_PATH` | 站点完整URL | 链接生成、资源引用 |
| `STATIC_URL` | `SITE_URL.'common/static/'` | 静态资源URL | CSS、JS、图片引用 |
| `MAGIC_QUOTES_GPC` | 动态检测 | 魔术引号状态 | 数据过滤、安全处理 |
| `RYCMS_SOFTNAME` | `'RYCMS内容管理系统'` | 软件名称 | 页面标题、版权信息 |

使用统计：
- `RYPHP_ROOT`: 约150+处引用（路径拼接）
- `SITE_URL`: 约80+处引用（URL生成）
- `STATIC_URL`: 约200+处引用（前端资源）
- `SYS_TIME`: 约100+处引用（时间相关）

---

### 1.3 应用层常量

#### `/ryphp/core/class/application.class.php`
路由相关常量：

| 常量名 | 说明 | 定义方式 | 使用位置 |
|--------|------|----------|----------|
| `ROUTE_M` | 当前模块名 | `$param->route_m()` | 控制器加载、模板路径、权限验证 |
| `ROUTE_C` | 当前控制器名 | `$param->route_c()` | 方法调用、模板选择、日志记录 |
| `ROUTE_A` | 当前方法名 | `$param->route_a()` | 方法执行、权限检查、URL生成 |

使用示例：
```php
// 控制器加载
ryphp::load_controller(ROUTE_C, ROUTE_M);

// URL生成
U(ROUTE_M.'/'.ROUTE_C.'/'.ROUTE_A);

// 权限检查
D('admin_role_auth')->where(array('m'=>ROUTE_M,'c'=>ROUTE_C,'a'=>ROUTE_A));
```

---

### 1.4 功能类常量

#### `/ryphp/core/class/tree.class.php`
- `EFFECTED_INIT` = `1` - 树形结构影响范围初始化标识

使用位置：
- `tree.class.php` 内部逻辑判断

#### `/ryphp/core/class/form.class.php`
- `DATETIME` = `1` - 日期时间字段标识

使用位置：
- 表单字段类型判断

#### `/ryphp/core/class/page.class.php`
- `TOTAL_PAGE` - 总页数

使用位置：
- 分页组件计算和显示

---

### 1.5 版本信息常量

#### `/common/data/version.php`

| 常量名 | 值 | 说明 | 使用位置 |
|--------|-----|------|----------|
| `RYCMS_VERSION` | `'V1.0'` | CMS版本号 | 后台版本显示、升级检查 |
| `RYCMS_UPDATE` | `'20250808'` | 更新日期 | 版本信息显示 |

使用位置：
- 后台系统信息页面
- 软件升级检测
- 版权信息显示

---

### 1.6 后台管理常量

#### `/application/lry_admin_center/controller/common.class.php`

| 常量名 | 值 | 说明 | 使用位置 |
|--------|-----|------|----------|
| `IN_RYPHP_ADMIN` | `true` | 后台管理标识 | 后台文件权限检查、安全验证 |

使用位置：
- 后台所有控制器继承 `common` 类
- 权限验证中检查
- 防止前台直接访问后台逻辑

---

### 1.7 安装程序常量

#### `/application/install/index.php`

| 常量名 | 值 | 说明 | 使用位置 |
|--------|-----|------|----------|
| `IN_RYPHP` | `true` | 框架标识 | 安装程序内部 |
| `APPDIR` | 动态计算 | 应用目录 | 文件路径计算 |
| `SITEDIR` | `dirname(APPDIR)` | 站点根目录 | 配置文件写入 |
| `VERSION` | `'RYCMS V1.0'` | 安装程序版本 | 安装界面显示 |

使用位置：
- 仅在安装过程中使用
- 数据库配置写入
- 目录权限检查

---

### 1.8 UEditor编辑器常量

#### `/common/static/plugin/ueditor/php/lry_action.php`

重新定义的常量（用于独立运行）：

| 常量名 | 说明 |
|--------|------|
| `RYPHP_DEBUG` | 调试模式 |
| `URL_MODEL` | URL模式 |
| `MAGIC_QUOTES_GPC` | 魔术引号 |
| `SYS_TIME` | 系统时间 |
| `SERVER_REQUEST_SCHEME` | 请求协议 |
| `HTTP_HOST` | 主机名 |
| `SITE_PATH` | 站点路径 |
| `SITE_URL` | 站点URL |
| `RYPHP_ROOT` | 根目录 |
| `RYPHP_APP` | 应用目录 |
| `EXT` | 类扩展名 |
| `IN_ADMIN` | 管理员标识（根据SESSION判断） |

使用位置：
- UEditor上传附件
- 图片管理
- 文件浏览

#### `/common/static/plugin/ueditor/php/controller.php`
- `IN_RYPHP` = `true` - 框架标识（重复定义）

---

### 1.9 动态定义常量（条件定义）

#### `/ryphp/core/function/global.func.php`

**调试隐藏标识**：
```php
function debug(){
    defined('RYPHP_DEBUG_HIDDEN') or define('RYPHP_DEBUG_HIDDEN', true);
}
```
使用位置：
- 需要临时屏蔽调试信息时调用

**模块主题设置**：
```php
function set_module_theme($theme = 'default'){
    defined('MODULE_THEME') or define('MODULE_THEME', $theme);
}
```
使用位置：
- 模板系统中动态设置主题
- 默认使用配置中的 `site_theme`

---

## 2. 配置数组变量

### 2.1 主配置文件

#### `/common/config/config.php`

这是一个返回数组的配置文件，包含以下配置组：

#### 系统配置组

| 配置键 | 默认值 | 说明 | 使用位置 |
|--------|--------|------|----------|
| `auth_key` | `bab56dc27fd02876a4b9de96f06b9e0e` | 系统密钥 | 数据加密、Token生成 |
| `error_page` | `404.html` | 错误页面 | 错误处理 |
| `error_log_save` | `1` | 是否保存错误日志 | 日志系统 |
| `site_theme` | `rongyao` | 默认主题 | 模板加载 |
| `url_html_suffix` | `.html` | URL后缀 | URL生成 |
| `set_pathinfo` | `false` | PATHINFO支持 | 路由解析 |

访问方式：
```php
C('auth_key')  // 使用C函数
config('config.auth_key')  // 使用config函数
```

使用统计：
- `auth_key`: 约20+处（加密解密）
- `site_theme`: 约15+处（模板系统）
- `url_html_suffix`: 约30+处（URL生成）

#### 数据库配置组

| 配置键 | 默认值 | 说明 | 使用位置 |
|--------|--------|------|----------|
| `db_type` | `pdo` | 数据库类型 | 数据库连接 |
| `db_host` | `127.0.0.1` | 服务器地址 | 数据库连接 |
| `db_name` | `rycms` | 数据库名 | 数据库连接 |
| `db_user` | `root` | 用户名 | 数据库连接 |
| `db_pwd` | `3.3.` | 密码 | 数据库连接 |
| `db_port` | `3306` | 端口 | 数据库连接 |
| `db_charset` | `utf8` | 字符集 | 数据库连接 |
| `db_prefix` | `rycms_` | 表前缀 | SQL查询 |

使用位置：
- `/ryphp/core/class/db_factory.class.php` - 数据库工厂类
- `/ryphp/core/class/db_pdo.class.php` - PDO连接类
- `/ryphp/core/class/db_mysqli.class.php` - MySQLi连接类
- `/ryphp/core/class/db_mysql.class.php` - MySQL连接类

使用统计：
- 数据库配置在所有数据库操作中使用，约500+处

#### 路由配置组

| 配置键 | 默认值 | 说明 | 使用位置 |
|--------|--------|------|----------|
| `route_config` | `array('default'=>array('m'=>'index', 'c'=>'index', 'a'=>'init'))` | 默认路由 | 路由解析 |
| `route_mapping` | `true` | 路由映射开关 | 路由系统 |
| `route_rules` | `array()` | 路由规则 | 自定义路由 |

使用位置：
- `/ryphp/core/class/param.class.php` - 参数解析类
- `/common/function/system.func.php` - URL映射函数

#### Cookie配置组

| 配置键 | 默认值 | 说明 | 使用位置 |
|--------|--------|------|----------|
| `cookie_domain` | `''` | Cookie域 | Cookie设置 |
| `cookie_path` | `'/'` | Cookie路径 | Cookie设置 |
| `cookie_ttl` | `0` | Cookie生命周期 | Cookie设置 |
| `cookie_pre` | `'lryphp_'` | Cookie前缀 | Cookie读写 |
| `cookie_secure` | `false` | HTTPS传输 | Cookie设置 |
| `cookie_httponly` | `false` | HTTP Only | Cookie安全 |

使用位置：
- `/ryphp/core/function/global.func.php` - `set_cookie()`, `get_cookie()`, `del_cookie()`

使用统计：
- Cookie操作约50+处

#### 缓存配置组

| 配置键 | 默认值 | 说明 | 使用位置 |
|--------|--------|------|----------|
| `cache_type` | `'file'` | 缓存类型 | 缓存系统 |
| `file_config` | 数组 | 文件缓存配置 | 文件缓存 |
| `redis_config` | 数组 | Redis配置 | Redis缓存 |
| `memcache_config` | 数组 | Memcache配置 | Memcache缓存 |

**文件缓存配置**：
- `cache_dir` - 缓存目录
- `suffix` - 缓存后缀
- `mode` - 缓存格式

使用位置：
- `/ryphp/core/class/cache_factory.class.php` - 缓存工厂
- `/ryphp/core/class/cache_file.class.php` - 文件缓存
- `/ryphp/core/class/cache_redis.class.php` - Redis缓存
- `/ryphp/core/class/cache_memcache.class.php` - Memcache缓存

#### 队列配置组

| 配置键 | 默认值 | 说明 | 使用位置 |
|--------|--------|------|----------|
| `queue_connection` | `'database'` | 队列驱动 | 队列系统 |
| `queue_name` | `'default'` | 队列名称 | 队列任务 |

使用位置：
- `/ryphp/core/class/queue_factory.class.php` - 队列工厂

#### 语言配置

| 配置键 | 默认值 | 说明 | 使用位置 |
|--------|--------|------|----------|
| `language` | `'zh_cn'` | 系统语言 | 语言包加载 |

使用位置：
- `/ryphp/core/function/global.func.php` - `L()` 函数

#### 附件配置组

| 配置键 | 默认值 | 说明 | 使用位置 |
|--------|--------|------|----------|
| `upload_type` | `'host'` | 上传类型 | 文件上传 |
| `upload_file` | `'uploads'` | 上传目录 | 文件保存 |
| `watermark_enable` | `1` | 水印开关 | 图片处理 |
| `watermark_name` | `'mark.png'` | 水印图片 | 水印添加 |
| `watermark_position` | `'7'` | 水印位置 | 水印位置 |

使用位置：
- `/ryphp/core/class/upload.class.php` - 上传类
- `/ryphp/core/class/image.class.php` - 图片处理类
- `/common/function/system.func.php` - 图片处理函数

#### 其他配置

| 配置键 | 默认值 | 说明 | 使用位置 |
|--------|--------|------|----------|
| `sql_execute` | `false` | 在线SQL执行 | 后台SQL工具 |
| `edit_template` | `false` | 在线编辑模板 | 后台模板编辑 |
| `admin_login_code` | `0` | 后台登录验证码 | 登录验证 |

---

### 2.2 动态配置（数据库配置表）

#### `rycms_config` 表配置

通过 `get_config()` 函数从数据库加载的配置：

```php
function get_config($key = ''){
    if(!$configs = getcache('configs')){
        $data = D('config')->where(array('status' => 1))->select();
        // ... 缓存处理
    }
    return $key ? $configs[$key] : $configs;
}
```

主要配置项（示例）：
- `site_name` - 网站名称
- `site_url` - 网站URL
- `site_keyword` - 网站关键词
- `site_description` - 网站描述
- `site_seo_division` - SEO分隔符
- `site_seo_suffix` - SEO后缀
- `mail_server` - 邮件服务器
- `mail_port` - 邮件端口
- `mail_user` - 邮件用户名
- `mail_pass` - 邮件密码
- `mail_from` - 发件人
- `admin_prohibit_ip` - 后台禁止IP
- `admin_log` - 后台日志开关
- `upload_image_types` - 图片类型
- `upload_types` - 附件类型
- `att_relation_content` - 附件关联内容
- `down_ignore_domain` - 下载忽略域名
- `url_mode` - URL模式

使用位置：
- 全系统范围，约200+处调用

---

## 3. 全局函数变量

### 3.1 核心函数库 `/ryphp/core/function/global.func.php`

#### 配置相关函数

**C() 函数** - 快速获取配置
```php
function C($key = '', $default = '')
```
使用位置：约150+处

**config() 函数** - 获取配置文件配置
```php
function config($key = '', $default = '')
```
使用位置：约20+处

**D() 函数** - 数据库对象
```php
function D($tablename)
```
使用位置：约500+处（所有数据库操作）

**M() 函数** - 实例化模型
```php
function M($classname, $m = '')
```
使用位置：约50+处

#### 缓存相关函数

**getcache() 函数** - 获取缓存
```php
function getcache($name)
```
使用位置：约80+处

**setcache() 函数** - 设置缓存
```php
function setcache($name, $data, $timeout = 0)
```
使用位置：约80+处

**delcache() 函数** - 删除缓存
```php
function delcache($name, $flush = false)
```
使用位置：约30+处

#### Session/Cookie相关函数

**new_session_start()** - 安全启动Session
```php
function new_session_start()
```
使用位置：
- 登录系统
- 后台管理
- 前台会员

**set_cookie()** - 设置Cookie
```php
function set_cookie($name, $value = '', $time = 0, $httponly = false)
```
使用位置：约30+处

**get_cookie()** - 获取Cookie
```php
function get_cookie($name = '', $default = '')
```
使用位置：约50+处

**del_cookie()** - 删除Cookie
```php
function del_cookie($name = '')
```
使用位置：约20+处

#### 安全相关函数

**safe_replace()** - 安全过滤
```php
function safe_replace($string)
```
使用位置：约100+处

**remove_xss()** - XSS过滤
```php
function remove_xss($string)
```
使用位置：约30+处

**string_auth()** - 加密解密
```php
function string_auth($string, $operation = 'ENCODE', $key = '', $expiry = 0)
```
使用位置：约40+处

**create_token()** - 创建Token
```php
function create_token($isinput = true)
```
使用位置：所有表单页面

**check_token()** - 验证Token
```php
function check_token($token, $delete=false)
```
使用位置：所有POST提交

#### URL相关函数

**U()** - URL生成
```php
function U($url = '', $vars = '', $domain = null, $suffix = true)
```
使用位置：约300+处

**get_url()** - 获取当前URL
```php
function get_url()
```
使用位置：约50+处

**redirect()** - URL重定向
```php
function redirect($url, $time=0, $msg='')
```
使用位置：约20+处

#### 请求判断函数

| 函数名 | 说明 | 使用次数 |
|--------|------|----------|
| `is_ssl()` | 是否HTTPS | 约20+处 |
| `is_post()` | 是否POST请求 | 约100+处 |
| `is_get()` | 是否GET请求 | 约50+处 |
| `is_put()` | 是否PUT请求 | 约10+处 |
| `is_ajax()` | 是否AJAX请求 | 约80+处 |

#### 数据处理函数

| 函数名 | 说明 | 使用次数 |
|--------|------|----------|
| `new_addslashes()` | 添加转义 | 约50+处 |
| `new_stripslashes()` | 移除转义 | 约50+处 |
| `new_html_special_chars()` | HTML转义 | 约100+处 |
| `array2string()` | 数组转字符串 | 约30+处 |
| `string2array()` | 字符串转数组 | 约30+处 |

#### 验证函数

| 函数名 | 说明 | 使用次数 |
|--------|------|----------|
| `is_email()` | 邮箱验证 | 约30+处 |
| `is_mobile()` | 手机号验证 | 约20+处 |
| `is_username()` | 用户名验证 | 约15+处 |
| `is_password()` | 密码验证 | 约15+处 |
| `is_img()` | 图片格式验证 | 约40+处 |
| `is_utf8()` | UTF8编码验证 | 约10+处 |

#### 工具函数

| 函数名 | 说明 | 使用次数 |
|--------|------|----------|
| `getip()` | 获取IP | 约100+处 |
| `random()` | 随机字符串 | 约80+处 |
| `P()` | 打印调试 | 开发调试使用 |
| `L()` | 语言包 | 约200+处 |
| `showmsg()` | 信息提示 | 约150+处 |
| `template()` | 模板加载 | 约100+处 |

---

### 3.2 系统函数库 `/common/function/system.func.php`

#### 内容管理函数

| 函数名 | 说明 | 使用位置 |
|--------|------|----------|
| `get_category()` | 获取栏目信息 | 约200+处（列表、详情页） |
| `get_catname()` | 获取栏目名称 | 约50+处 |
| `get_childcat()` | 获取子栏目 | 约30+处 |
| `get_location()` | 获取面包屑 | 约50+处 |
| `get_model()` | 获取模型信息 | 约80+处 |
| `get_content_url()` | 获取内容URL | 约100+处 |
| `get_content_keyword()` | 获取关键字 | 约20+处 |
| `content_total()` | 获取内容总数 | 约30+处 |

#### 站点管理函数

| 函数名 | 说明 | 使用位置 |
|--------|------|----------|
| `get_siteid()` | 获取站点ID | 约100+处 |
| `get_site()` | 获取站点信息 | 约50+处 |
| `get_site_url()` | 获取站点URL | 约30+处 |
| `get_site_seo()` | 获取SEO信息 | 约40+处 |
| `get_seo_suffix()` | 获取SEO后缀 | 约20+处 |

#### 会员管理函数

| 函数名 | 说明 | 使用位置 |
|--------|------|----------|
| `get_memberinfo()` | 获取会员信息 | 约50+处 |
| `get_memberavatar()` | 获取会员头像 | 约30+处 |
| `get_groupinfo()` | 获取组别信息 | 约20+处 |
| `get_groupname()` | 获取组别名称 | 约10+处 |
| `password()` | 密码加密 | 约15+处 |

#### 图片处理函数

| 函数名 | 说明 | 使用位置 |
|--------|------|----------|
| `thumb()` | 生成缩略图 | 约80+处 |
| `watermark()` | 添加水印 | 约30+处 |
| `get_thumb()` | 获取缩略图 | 约50+处 |
| `match_img()` | 匹配图片 | 约20+处 |
| `grab_image()` | 抓取远程图片 | 约10+处 |
| `down_remote_img()` | 下载远程图片 | 约10+处 |

#### 表单相关函数

| 函数名 | 说明 | 使用位置 |
|--------|------|----------|
| `select_category()` | 栏目下拉框 | 约30+处 |
| `get_field_val()` | 获取字段值 | 约20+处 |
| `field_order()` | 字段排序 | 约15+处 |

#### 其他辅助函数

| 函数名 | 说明 | 使用位置 |
|--------|------|----------|
| `sendmail()` | 发送邮件 | 约10+处 |
| `ismobile()` | 是否手机访问 | 约20+处 |
| `file_icon()` | 文件图标 | 约30+处 |
| `adver()` | 广告调用 | 模板中使用 |
| `tag_url()` | Tag链接 | 约20+处 |
| `mobile_url()` | 手机版URL | 约15+处 |
| `title_color()` | 标题颜色 | 模板中使用 |

---

## 4. Session 变量

### 4.1 管理员 Session

| 变量名 | 说明 | 设置位置 | 使用位置 |
|--------|------|----------|----------|
| `$_SESSION['adminid']` | 管理员ID | 登录成功 | 权限验证、日志记录 |
| `$_SESSION['adminname']` | 管理员名称 | 登录成功 | 日志记录、页面显示 |
| `$_SESSION['roleid']` | 角色ID | 登录成功 | 权限验证 |
| `$_SESSION['rolename']` | 角色名称 | 登录成功 | 页面显示 |
| `$_SESSION['lry_sey_token']` | CSRF Token | Token创建 | 表单验证 |
| `$_SESSION['lry_lock_screen']` | 锁屏状态 | 锁屏操作 | 后台访问控制 |
| `$_SESSION['attachmentid']` | 附件ID | 上传文件 | 附件关联 |

使用统计：
- 后台所有页面都使用管理员Session
- 约200+处引用

### 4.2 会员 Session

| 变量名 | 说明 | 设置位置 | 使用位置 |
|--------|------|----------|----------|
| `$_SESSION['_userid']` | 会员ID | 会员登录 | 权限验证、内容投稿 |
| `$_SESSION['_username']` | 会员名称 | 会员登录 | 页面显示 |
| `$_SESSION['_groupid']` | 会员组ID | 会员登录 | 权限判断 |
| `$_SESSION['_userpic']` | 会员头像 | 会员登录 | 页面显示 |

使用统计：
- 前台会员功能约100+处引用

### 4.3 其他 Session

| 变量名 | 说明 | 使用位置 |
|--------|------|----------|
| `$_SESSION['verify_code']` | 验证码 | 验证码验证 |
| `$_SESSION['login_error']` | 登录错误次数 | 登录限制 |

---

## 5. Cookie 变量

### 5.1 管理员 Cookie

| 变量名 | 说明 | 过期时间 | 使用位置 |
|--------|------|----------|----------|
| `{$pre}adminid` | 管理员ID | 7天 | 登录验证 |
| `{$pre}adminname` | 管理员名称 | 7天 | 记住登录 |

注：`{$pre}` 为配置的Cookie前缀，默认为 `lryphp_`

### 5.2 会员 Cookie

| 变量名 | 说明 | 过期时间 | 使用位置 |
|--------|------|----------|----------|
| `{$pre}_userid` | 会员ID | 30天 | 自动登录 |
| `{$pre}_auth` | 认证字符串 | 30天 | 登录验证 |
| `{$pre}attachmentid` | 附件ID | 临时 | 附件上传 |

### 5.3 其他 Cookie

| 变量名 | 说明 | 使用位置 |
|--------|------|----------|
| `{$pre}theme` | 主题选择 | 主题切换 |
| `{$pre}lang` | 语言选择 | 语言切换 |

使用统计：
- Cookie操作约80+处

---

## 6. 全局变量使用统计

### 6.1 使用频率TOP 20

| 变量/函数 | 类型 | 使用次数（估算） | 主要用途 |
|----------|------|-----------------|----------|
| `D()` | 函数 | 500+ | 数据库操作 |
| `RYPHP_ROOT` | 常量 | 300+ | 路径拼接 |
| `U()` | 函数 | 300+ | URL生成 |
| `L()` | 函数 | 200+ | 语言包 |
| `STATIC_URL` | 常量 | 200+ | 静态资源 |
| `get_category()` | 函数 | 200+ | 栏目信息 |
| `C()` | 函数 | 150+ | 配置读取 |
| `showmsg()` | 函数 | 150+ | 信息提示 |
| `SYS_TIME` | 常量 | 100+ | 时间戳 |
| `get_content_url()` | 函数 | 100+ | 内容URL |
| `is_post()` | 函数 | 100+ | 请求判断 |
| `new_html_special_chars()` | 函数 | 100+ | 安全过滤 |
| `getip()` | 函数 | 100+ | 获取IP |
| `get_siteid()` | 函数 | 100+ | 站点ID |
| `template()` | 函数 | 100+ | 模板加载 |
| `safe_replace()` | 函数 | 100+ | 安全过滤 |
| `ROUTE_M` | 常量 | 100+ | 路由模块 |
| `ROUTE_C` | 常量 | 100+ | 路由控制器 |
| `ROUTE_A` | 常量 | 100+ | 路由方法 |
| `SITE_URL` | 常量 | 80+ | 站点URL |

### 6.2 按功能分类统计

#### 数据库相关
- `D()`: 500+
- 数据库配置: 500+
- 总计：约1000+处

#### URL路由相关
- `U()`: 300+
- `ROUTE_M/C/A`: 300+
- `SITE_URL`: 80+
- `URL_MODEL`: 50+
- 总计：约730+处

#### 配置相关
- `C()`: 150+
- `config()`: 20+
- `get_config()`: 200+
- 总计：约370+处

#### 安全相关
- `safe_replace()`: 100+
- `new_html_special_chars()`: 100+
- `remove_xss()`: 30+
- `string_auth()`: 40+
- Token函数: 50+
- 总计：约320+处

#### 内容管理相关
- `get_category()`: 200+
- `get_content_url()`: 100+
- 其他内容函数: 200+
- 总计：约500+处

#### 模板相关
- `template()`: 100+
- `STATIC_URL`: 200+
- 模板函数: 100+
- 总计：约400+处

---

## 7. 变量定义最佳实践

### 7.1 常量定义规范

1. **命名规范**
   - 全大写字母
   - 单词间用下划线分隔
   - 使用有意义的名称

2. **安全检查**
   ```php
   defined('CONSTANT_NAME') or define('CONSTANT_NAME', 'value');
   ```

3. **分类组织**
   - 系统常量：`RYPHP_*`
   - 路由常量：`ROUTE_*`
   - 网络常量：`HTTP_*`, `SERVER_*`
   - 时间常量：`SYS_*`

### 7.2 配置变量规范

1. **使用统一的访问函数**
   ```php
   C('config_key')        // 主配置
   config('file.key')     // 文件配置
   get_config('key')      // 数据库配置
   ```

2. **配置缓存**
   - 数据库配置使用缓存机制
   - 减少数据库查询

3. **环境配置**
   ```php
   env('ENV_KEY', 'default')  // .env文件配置
   ```

### 7.3 全局变量使用规范

1. **避免直接使用$_SESSION**
   - 使用封装函数
   - 统一前缀命名

2. **Cookie使用规范**
   - 使用 `set_cookie()`, `get_cookie()`, `del_cookie()`
   - 自动加密解密

3. **数据过滤**
   - 输入使用 `safe_replace()`, `new_html_special_chars()`
   - 输出使用 `htmlspecialchars()`

---

## 8. 变量使用注意事项

### 8.1 安全注意事项

1. **常量不可修改**
   - 定义后无法更改
   - 避免重复定义

2. **配置文件保护**
   - 所有配置文件开头检查 `IN_RYPHP`
   - 数据库密码等敏感信息注意保护

3. **Session安全**
   - 使用 `new_session_start()` 启动Session
   - 设置 `httponly` 标志

4. **Cookie安全**
   - 自动加密存储
   - 设置合适的过期时间

### 8.2 性能注意事项

1. **缓存机制**
   - 配置使用静态变量缓存
   - 数据库配置使用缓存系统

2. **避免重复查询**
   - 一次查询，多次使用
   - 使用全局变量存储

3. **常量优先**
   - 固定值使用常量
   - 访问速度快于变量

### 8.3 兼容性注意事项

1. **PHP版本兼容**
   - 魔术引号检查
   - 函数存在性检查

2. **跨平台路径**
   - 使用 `DIRECTORY_SEPARATOR`
   - 路径标准化处理

---

## 9. 附录

### 9.1 快速查找索引

#### 按字母顺序

**A-C**
- `APPDIR` - 应用目录（安装程序）
- `auth_key` - 系统密钥
- `C()` - 配置函数
- `cache_type` - 缓存类型
- `config()` - 配置文件函数
- `cookie_pre` - Cookie前缀

**D-E**
- `D()` - 数据库对象
- `DATETIME` - 日期时间标识
- `db_*` - 数据库配置组
- `EFFECTED_INIT` - 树结构标识
- `EXT` - 类文件扩展名

**G-I**
- `get_category()` - 获取栏目
- `get_config()` - 获取配置
- `HTTP_HOST` - 主机名
- `HTTP_REFERER` - 来源地址
- `IN_ADMIN` - 管理员标识
- `IN_RYPHP` - 框架标识
- `IN_RYPHP_ADMIN` - 后台标识
- `IS_CGI` - CGI模式

**L-P**
- `L()` - 语言包函数
- `M()` - 模型函数
- `MAGIC_QUOTES_GPC` - 魔术引号
- `MODULE_THEME` - 模块主题
- `PHP_FILE` - PHP文件路径

**R-S**
- `ROUTE_A` - 路由方法
- `ROUTE_C` - 路由控制器
- `ROUTE_M` - 路由模块
- `RYCMS_*` - CMS相关常量
- `RYPHP_*` - 框架相关常量
- `SERVER_REQUEST_SCHEME` - 请求协议
- `SITE_PATH` - 站点路径
- `SITE_URL` - 站点URL
- `SITEDIR` - 站点目录（安装程序）
- `STATIC_URL` - 静态资源URL
- `SYS_START_TIME` - 启动时间
- `SYS_TIME` - 当前时间

**T-U**
- `TOTAL_PAGE` - 总页数
- `U()` - URL生成函数
- `URL_MODEL` - URL模式
- `upload_type` - 上传类型

**V-Z**
- `VERSION` - 版本（安装程序）

### 9.2 文件清单

#### 常量定义文件
1. `/index.php`
2. `/ryphp/ryphp.php`
3. `/common/data/version.php`
4. `/ryphp/core/class/application.class.php`
5. `/ryphp/core/class/tree.class.php`
6. `/ryphp/core/class/form.class.php`
7. `/ryphp/core/class/page.class.php`
8. `/application/lry_admin_center/controller/common.class.php`
9. `/application/install/index.php`
10. `/common/static/plugin/ueditor/php/lry_action.php`
11. `/common/static/plugin/ueditor/php/controller.php`

#### 配置文件
1. `/common/config/config.php` - 主配置文件

#### 函数库文件
1. `/ryphp/core/function/global.func.php` - 核心函数库
2. `/common/function/system.func.php` - 系统函数库
3. `/common/function/extention.func.php` - 扩展函数库

---

## 10. 总结

### 10.1 项目变量统计

- **常量定义**：约50个
- **配置项**：约60个（文件配置 + 数据库配置）
- **核心函数**：约150个
- **Session变量**：约15个
- **Cookie变量**：约10个

### 10.2 主要特点

1. **统一命名规范**
   - 常量全大写
   - 函数小写+下划线
   - 配置小写+下划线

2. **分层设计**
   - 框架层常量（RYPHP_*）
   - 应用层常量（ROUTE_*）
   - 业务层配置（get_config）

3. **安全机制**
   - 入口检查（IN_RYPHP）
   - 数据加密（string_auth）
   - XSS过滤（remove_xss）
   - CSRF防护（Token机制）

4. **缓存优化**
   - 配置缓存
   - 静态变量缓存
   - 文件/Redis缓存

### 10.3 使用建议

1. **新增变量时**
   - 遵循命名规范
   - 添加注释说明
   - 考虑安全性

2. **修改配置时**
   - 使用配置函数
   - 清除相关缓存
   - 测试影响范围

3. **查找变量时**
   - 使用本文档索引
   - 全局搜索定义位置
   - 查看使用示例

---

**文档维护**：
- 当前版本：1.0
- 更新日期：2025-10-06
- 维护者：系统管理员

**相关文档**：
- [项目常量文档](./Constant.md)
- [RYPHP框架文档](./ryphp.md)
- [系统函数说明](./ryphp/core/function/README.md)

---

**版权声明**：
本文档为 lryblog.com 项目内部技术文档，仅供项目开发和维护使用。

